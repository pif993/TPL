<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="referrer" content="no-referrer">
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 connect-src 'self';
                 img-src 'self' data:;
                 style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;
                 script-src 'self' https://cdn.jsdelivr.net;
                 font-src 'self' data: https://cdn.jsdelivr.net;
                 base-uri 'self';
                 form-action 'self';
                 frame-ancestors 'none';">
  <title>TPL · Secure Access</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link href="/styles.css" rel="stylesheet">
</head>
<body class="tpl-auth-body">

  <div class="tpl-auth-page">

    <!-- ═══ LEFT: Brand Panel ═══════════════════════════════════ -->
    <aside class="tpl-auth-brand" aria-label="TPL Fortress branding">
      <!-- Animated background orbs -->
      <div class="tpl-auth-orb tpl-auth-orb--1" aria-hidden="true"></div>
      <div class="tpl-auth-orb tpl-auth-orb--2" aria-hidden="true"></div>
      <div class="tpl-auth-orb tpl-auth-orb--3" aria-hidden="true"></div>

      <div class="tpl-auth-brand-inner">
        <!-- Logo -->
        <div class="tpl-auth-logo" aria-hidden="true">
          <i class="bi bi-shield-lock-fill"></i>
        </div>
        <h1 class="tpl-auth-app-name">TPL Fortress</h1>
        <p class="tpl-auth-tagline" data-i18n="login.hero_subtitle">
          Piattaforma di gestione sicura<br>con crittografia end-to-end
        </p>

        <!-- Security features -->
        <div class="tpl-auth-feats" role="list" aria-label="Security features">
          <div class="tpl-auth-feat" role="listitem">
            <div class="tpl-auth-feat-icon"><i class="bi bi-key-fill" aria-hidden="true"></i></div>
            <div>
              <div class="tpl-auth-feat-title" data-i18n="login.feature1_title">Crittografia Ed25519</div>
              <div class="tpl-auth-feat-desc" data-i18n="login.feature1_desc">JWT firmati con chiavi asimmetriche.</div>
            </div>
          </div>
          <div class="tpl-auth-feat" role="listitem">
            <div class="tpl-auth-feat-icon"><i class="bi bi-arrow-repeat" aria-hidden="true"></i></div>
            <div>
              <div class="tpl-auth-feat-title" data-i18n="login.feature2_title">Rotazione token automatica</div>
              <div class="tpl-auth-feat-desc" data-i18n="login.feature2_desc">Refresh token monouso con rilevamento furto.</div>
            </div>
          </div>
          <div class="tpl-auth-feat" role="listitem">
            <div class="tpl-auth-feat-icon"><i class="bi bi-hourglass-split" aria-hidden="true"></i></div>
            <div>
              <div class="tpl-auth-feat-title" data-i18n="login.feature3_title">Sessioni a vita breve</div>
              <div class="tpl-auth-feat-desc" data-i18n="login.feature3_desc">Access token 15 min, rinnovo trasparente.</div>
            </div>
          </div>
          <div class="tpl-auth-feat" role="listitem">
            <div class="tpl-auth-feat-icon"><i class="bi bi-database-lock" aria-hidden="true"></i></div>
            <div>
              <div class="tpl-auth-feat-title" data-i18n="login.feature4_title">Credential Vault</div>
              <div class="tpl-auth-feat-desc" data-i18n="login.feature4_desc">Breach detection, password history, policy avanzate.</div>
            </div>
          </div>
        </div>

        <div class="tpl-auth-brand-footer">
          &copy; TPL Fortress v3.0 &mdash; Ed25519 + Argon2id
        </div>
      </div>
    </aside>

    <!-- ═══ RIGHT: Form Panel ═══════════════════════════════════ -->
    <main class="tpl-auth-form-panel" role="main">
      <div class="tpl-auth-form-container">

        <!-- Top bar: security badge + lang -->
        <div class="tpl-auth-topbar">
          <div class="tpl-auth-sec-badge" id="secBadge" role="status" aria-live="polite">
            <i class="bi bi-lock-fill" aria-hidden="true"></i>
            <span id="secLabel">Connessione sicura</span>
          </div>
          <select id="lang" class="tpl-auth-lang" aria-label="Lingua">
            <option value="it">IT</option>
            <option value="en">EN</option>
          </select>
        </div>

        <!-- Mobile logo (visible only on small screens) -->
        <div class="tpl-auth-mobile-brand">
          <div class="tpl-auth-logo tpl-auth-logo--sm" aria-hidden="true">
            <i class="bi bi-shield-lock-fill"></i>
          </div>
          <span class="tpl-auth-mobile-title">TPL Fortress</span>
        </div>

        <!-- Form header -->
        <div class="tpl-auth-header">
          <h2 class="tpl-auth-title">Bentornato</h2>
          <p class="tpl-auth-subtitle">Inserisci le tue credenziali per accedere alla piattaforma</p>
        </div>

        <!-- Login form -->
        <form id="loginForm" class="tpl-auth-form" autocomplete="on" novalidate>
          <div class="tpl-auth-field">
            <label class="tpl-auth-label" for="u">
              <span data-i18n="login.username">Username</span>
            </label>
            <div class="tpl-auth-input-wrap">
              <i class="bi bi-person tpl-auth-input-icon" aria-hidden="true"></i>
              <input class="tpl-auth-input" id="u" name="username" maxlength="64"
                     placeholder="Il tuo username" data-i18n-placeholder="login.username_placeholder"
                     autocomplete="username" autocapitalize="off" autocorrect="off"
                     spellcheck="false" autofocus required
                     aria-required="true" aria-label="Username">
            </div>
          </div>

          <div class="tpl-auth-field">
            <label class="tpl-auth-label" for="p">
              <span data-i18n="login.password">Password</span>
            </label>
            <div class="tpl-auth-input-wrap">
              <i class="bi bi-key tpl-auth-input-icon" aria-hidden="true"></i>
              <input class="tpl-auth-input tpl-auth-input--pw" id="p" name="password" type="password" maxlength="256"
                     placeholder="La tua password" data-i18n-placeholder="login.password_placeholder"
                     autocomplete="current-password" required
                     aria-required="true" aria-label="Password">
              <button class="tpl-auth-pw-toggle" type="button" id="togglePw" tabindex="-1"
                      aria-label="Mostra/nascondi password" title="Mostra/nascondi password">
                <i class="bi bi-eye" id="togglePwIcon" aria-hidden="true"></i>
              </button>
            </div>
          </div>

          <button class="ov-login-btn tpl-auth-submit" id="go" type="submit" data-i18n="login.sign_in">
            <i class="bi bi-arrow-right-circle-fill" aria-hidden="true"></i>
            <span>Accedi</span>
          </button>

          <!-- Session info -->
          <div class="tpl-auth-session" id="sessionInfo" style="display:none" role="status" aria-live="polite">
            <i class="bi bi-clock-history" aria-hidden="true"></i>
            Token scade tra <span id="tokenTTL">15</span> min
          </div>

          <!-- Toast / feedback -->
          <div class="ov-toast ov-toast--info mt-3" id="o" style="display:none" role="alert" aria-live="assertive">&mdash;</div>
        </form>

        <!-- Footer (desktop) -->
        <div class="tpl-auth-footer">
          <span class="tpl-auth-poweredby">Powered by Ed25519 + Argon2id</span>
        </div>
      </div>
    </main>

  </div>

  <!-- ═══ Password Change Modal (first login / expired) ═══════ -->
  <div class="ov-pw-overlay" id="pwOverlay" style="display:none">
    <div class="ov-pw-card tpl-pw-card">
      <div class="ov-pw-header tpl-pw-header">
        <div class="ov-pw-icon tpl-pw-icon"><i class="bi bi-shield-lock-fill"></i></div>
        <h2 class="ov-pw-title tpl-pw-title">Cambio Password Obbligatorio</h2>
        <p class="ov-pw-subtitle tpl-pw-subtitle">La tua password non soddisfa la policy di sicurezza attuale. Scegline una nuova per continuare.</p>
      </div>
      <div class="ov-pw-body tpl-pw-body">
        <div class="tpl-pw-field">
          <label class="tpl-auth-label" for="pwCurrent"><i class="bi bi-key" aria-hidden="true"></i> Password attuale</label>
          <div class="tpl-auth-input-wrap">
            <i class="bi bi-key tpl-auth-input-icon" aria-hidden="true"></i>
            <input class="tpl-auth-input" id="pwCurrent" type="password" maxlength="256"
                   placeholder="Password attuale" autocomplete="current-password">
          </div>
        </div>
        <div class="tpl-pw-field">
          <label class="tpl-auth-label" for="pwNew"><i class="bi bi-lock" aria-hidden="true"></i> Nuova password</label>
          <div class="tpl-auth-input-wrap">
            <i class="bi bi-lock tpl-auth-input-icon" aria-hidden="true"></i>
            <input class="tpl-auth-input" id="pwNew" type="password" maxlength="256"
                   placeholder="Nuova password (min 14 caratteri)" autocomplete="new-password">
          </div>
          <div class="ov-pw-strength" id="pwStrength"></div>
        </div>
        <div class="tpl-pw-field">
          <label class="tpl-auth-label" for="pwConfirm"><i class="bi bi-lock-fill" aria-hidden="true"></i> Conferma nuova password</label>
          <div class="tpl-auth-input-wrap">
            <i class="bi bi-lock-fill tpl-auth-input-icon" aria-hidden="true"></i>
            <input class="tpl-auth-input" id="pwConfirm" type="password" maxlength="256"
                   placeholder="Ripeti nuova password" autocomplete="new-password">
          </div>
        </div>
        <ul class="ov-pw-rules" id="pwRules">
          <li id="pwRuleLen"><i class="bi bi-x-circle"></i> Almeno <span id="pwMinLen">14</span> caratteri</li>
          <li id="pwRuleUpper"><i class="bi bi-x-circle"></i> Almeno una lettera maiuscola</li>
          <li id="pwRuleLower"><i class="bi bi-x-circle"></i> Almeno una lettera minuscola</li>
          <li id="pwRuleDigit"><i class="bi bi-x-circle"></i> Almeno un numero</li>
          <li id="pwRuleSpecial"><i class="bi bi-x-circle"></i> Almeno un carattere speciale (!@#$...)</li>
          <li id="pwRuleMatch"><i class="bi bi-x-circle"></i> Le password corrispondono</li>
          <li id="pwRuleNoUser"><i class="bi bi-x-circle"></i> Non contiene lo username</li>
        </ul>
        <button class="ov-login-btn tpl-auth-submit" id="pwSubmit" type="button" disabled>
          <i class="bi bi-check-circle-fill" aria-hidden="true"></i>
          <span>Cambia Password</span>
        </button>
        <div class="ov-toast ov-toast--info mt-3" id="pwMsg" style="display:none"></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/app.js"></script>
  <script src="/landing.js"></script>
</body>
</html>
