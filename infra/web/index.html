<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="referrer" content="no-referrer">
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 connect-src 'self';
                 img-src 'self' data:;
                 style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;
                 script-src 'self' https://cdn.jsdelivr.net;
                 font-src 'self' data: https://cdn.jsdelivr.net;
                 base-uri 'self';
                 form-action 'self';
                 frame-ancestors 'none';">
  <title>TPL · Secure Access</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link href="/styles.css" rel="stylesheet">
</head>
<body>

  <div class="ov-login-page">
    <div class="ov-login-box">

      <!-- Login Card -->
      <div class="ov-login-card" role="main">

        <!-- Brand Header -->
        <div class="ov-login-brand">
          <div class="ov-login-logo" aria-hidden="true"><i class="bi bi-shield-lock-fill"></i></div>
          <h1 class="ov-login-title">TPL Fortress</h1>
          <p class="ov-login-subtitle" data-i18n="login.hero_subtitle">Accesso sicuro con crittografia Ed25519</p>
        </div>

        <!-- Security indicator -->
        <div class="ov-security-badge" id="secBadge" role="status" aria-live="polite">
          <i class="bi bi-lock-fill" aria-hidden="true"></i>
          <span id="secLabel">Connessione sicura</span>
        </div>

        <!-- Form -->
        <form class="ov-login-form" id="loginForm" autocomplete="on" novalidate>
          <div class="mb-3">
            <label class="form-label" for="u">
              <i class="bi bi-person-fill" aria-hidden="true"></i>
              <span data-i18n="login.username">Username</span>
            </label>
            <input class="form-control" id="u" name="username" maxlength="64"
                   placeholder="Inserisci il tuo username" data-i18n-placeholder="login.username_placeholder"
                   autocomplete="username" autocapitalize="off" autocorrect="off"
                   spellcheck="false" autofocus required
                   aria-required="true" aria-label="Username">
          </div>
          <div class="mb-3">
            <label class="form-label" for="p">
              <i class="bi bi-key-fill" aria-hidden="true"></i>
              <span data-i18n="login.password">Password</span>
            </label>
            <div class="input-group">
              <input class="form-control" id="p" name="password" type="password" maxlength="256"
                     placeholder="Inserisci la password" data-i18n-placeholder="login.password_placeholder"
                     autocomplete="current-password" required
                     aria-required="true" aria-label="Password">
              <button class="btn btn-outline-secondary" type="button" id="togglePw" tabindex="-1"
                      aria-label="Mostra/nascondi password" title="Mostra/nascondi password">
                <i class="bi bi-eye" id="togglePwIcon" aria-hidden="true"></i>
              </button>
            </div>
          </div>

          <button class="ov-login-btn" id="go" type="submit" data-i18n="login.sign_in">
            <i class="bi bi-box-arrow-in-right" aria-hidden="true"></i> Accedi
          </button>

          <!-- Session info -->
          <div class="ov-session-info mt-3" id="sessionInfo" style="display:none" role="status" aria-live="polite">
            <small><i class="bi bi-clock-history" aria-hidden="true"></i> Token scade tra <span id="tokenTTL">15</span> min</small>
          </div>

          <div class="ov-toast ov-toast--info mt-3" id="o" style="display:none" role="alert" aria-live="assertive">&mdash;</div>
        </form>

        <!-- Footer -->
        <div class="ov-login-footer">
          <span style="font-size:.73rem;color:var(--ov-text-faint,rgba(148,163,184,.45))">&copy; TPL Fortress v3.0 &mdash; Ed25519 + Argon2id</span>
          <select id="lang" class="ov-login-lang" aria-label="Lingua">
            <option value="it">IT</option>
            <option value="en">EN</option>
          </select>
        </div>

      </div>

      <!-- Feature highlights -->
      <div class="ov-login-features" role="list" aria-label="Security features">
        <div class="ov-login-feat" role="listitem">
          <i class="bi bi-key-fill" aria-hidden="true"></i>
          <div>
            <div style="font-weight:600;margin-bottom:.1rem" data-i18n="login.feature1_title">Crittografia Ed25519</div>
            <div style="font-size:.72rem;opacity:.55;line-height:1.35" data-i18n="login.feature1_desc">JWT firmati con chiavi asimmetriche Ed25519.</div>
          </div>
        </div>
        <div class="ov-login-feat" role="listitem">
          <i class="bi bi-shield-lock-fill" aria-hidden="true"></i>
          <div>
            <div style="font-weight:600;margin-bottom:.1rem" data-i18n="login.feature2_title">Sessioni con rotazione token</div>
            <div style="font-size:.72rem;opacity:.55;line-height:1.35" data-i18n="login.feature2_desc">Refresh token monouso con rilevamento furto.</div>
          </div>
        </div>
        <div class="ov-login-feat" role="listitem">
          <i class="bi bi-clock-history" aria-hidden="true"></i>
          <div>
            <div style="font-weight:600;margin-bottom:.1rem" data-i18n="login.feature3_title">Token a vita breve</div>
            <div style="font-size:.72rem;opacity:.55;line-height:1.35" data-i18n="login.feature3_desc">Access token 15 minuti, rinnovo automatico.</div>
          </div>
        </div>
        <div class="ov-login-feat" role="listitem">
          <i class="bi bi-database-lock" aria-hidden="true"></i>
          <div>
            <div style="font-weight:600;margin-bottom:.1rem" data-i18n="login.feature4_title">Credential Vault</div>
            <div style="font-size:.72rem;opacity:.55;line-height:1.35" data-i18n="login.feature4_desc">Controllo breach, cronologia password, policy avanzate.</div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- ── Password Change Modal (first login / expired) ───────────────────── -->
  <div class="ov-pw-overlay" id="pwOverlay" style="display:none">
    <div class="ov-pw-card">
      <div class="ov-pw-header">
        <div class="ov-pw-icon"><i class="bi bi-shield-lock-fill"></i></div>
        <h2 class="ov-pw-title">Cambio Password Obbligatorio</h2>
        <p class="ov-pw-subtitle">La tua password non soddisfa la policy di sicurezza attuale.</p>
      </div>
      <div class="ov-pw-body">
        <div class="mb-3">
          <label class="form-label" for="pwCurrent"><i class="bi bi-key"></i> Password attuale</label>
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-key"></i></span>
            <input class="form-control" id="pwCurrent" type="password" maxlength="256"
                   placeholder="Password attuale" autocomplete="current-password">
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label" for="pwNew"><i class="bi bi-lock"></i> Nuova password</label>
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-lock"></i></span>
            <input class="form-control" id="pwNew" type="password" maxlength="256"
                   placeholder="Nuova password (min 14 caratteri)" autocomplete="new-password">
          </div>
          <div class="ov-pw-strength" id="pwStrength"></div>
        </div>
        <div class="mb-3">
          <label class="form-label" for="pwConfirm"><i class="bi bi-lock-fill"></i> Conferma nuova password</label>
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-lock-fill"></i></span>
            <input class="form-control" id="pwConfirm" type="password" maxlength="256"
                   placeholder="Ripeti nuova password" autocomplete="new-password">
          </div>
        </div>
        <ul class="ov-pw-rules" id="pwRules">
          <li id="pwRuleLen"><i class="bi bi-x-circle"></i> Almeno <span id="pwMinLen">14</span> caratteri</li>
          <li id="pwRuleUpper"><i class="bi bi-x-circle"></i> Almeno una lettera maiuscola</li>
          <li id="pwRuleLower"><i class="bi bi-x-circle"></i> Almeno una lettera minuscola</li>
          <li id="pwRuleDigit"><i class="bi bi-x-circle"></i> Almeno un numero</li>
          <li id="pwRuleSpecial"><i class="bi bi-x-circle"></i> Almeno un carattere speciale (!@#$...)</li>
          <li id="pwRuleMatch"><i class="bi bi-x-circle"></i> Le password corrispondono</li>
          <li id="pwRuleNoUser"><i class="bi bi-x-circle"></i> Non contiene lo username</li>
        </ul>
        <button class="ov-login-btn" id="pwSubmit" type="button" disabled>
          <i class="bi bi-check-circle"></i> Cambia Password
        </button>
        <div class="ov-toast ov-toast--info mt-3" id="pwMsg" style="display:none"></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/app.js"></script>
  <script src="/landing.js"></script>
</body>
</html>
