# ═══════════════════════════════════════════════════════════════════════════════
#  TPL – Configuration template
# ═══════════════════════════════════════════════════════════════════════════════
#  This file is a TEMPLATE — do NOT edit directly.
#  Run: sudo ./install.sh        → generates /etc/tpl/config.env + secrets
#  Or:  ./init.sh auto-install   → dev mode (local paths, auto-generated)
#
#  Secrets are NEVER stored here — they live in /opt/tpl/secrets/ (prod)
#  or .secrets/ (dev), auto-generated by install.sh or init.sh.
# ═══════════════════════════════════════════════════════════════════════════════

# ── Environment ───────────────────────────────────────────────────────────────
APP_ENV=prod                           # prod or dev
# TPL_HOME=/opt/tpl                    # Set by install.sh

# ── Domain / Access ───────────────────────────────────────────────────────────
DOMAIN_MODE=local                      # local | vpn | public | proxy
# PUBLIC_DOMAIN=                       # Required for DOMAIN_MODE=public
TPL_URL=https://localhost              # Full URL (set by install.sh)

# ── Paths (host-side, mounted into containers) ────────────────────────────────
# TPL_SECRETS_DIR_HOST=/opt/tpl/secrets    # Prod (chmod 700). Dev default: ./.secrets
# TPL_DATA_DIR_HOST=/var/lib/tpl           # Prod. Dev default: ./data
# TPL_LOG_DIR_HOST=/var/log/tpl            # Prod. Dev default: ./logs
# TPL_TLS_DIR=/opt/tpl/secrets/tls         # TLS certs

# ── Traefik ports ─────────────────────────────────────────────────────────────
TRAEFIK_HTTP_PORT=80
TRAEFIK_HTTPS_PORT=443

# ── Auth ──────────────────────────────────────────────────────────────────────
AUTH_MODE=local
# OIDC_ISSUER=http://keycloak:8080/realms/myapp
# OIDC_CLIENT_ID=myapp-web

# ── Rate-limiting ─────────────────────────────────────────────────────────────
LOGIN_WINDOW_SECONDS=120
LOGIN_MAX_ATTEMPTS=8
JWT_TTL_SECONDS=3600

# ── Security ──────────────────────────────────────────────────────────────────
FORCE_HTTPS=true
# BOOTSTRAP_MODE: auto = enable for first login, auto-disable after user creation
#   true/false = explicit override (never auto-changes)
BOOTSTRAP_MODE=auto
ENABLE_CONTROL_PLANE=0                 # ⚠ NEVER enable in production (RCE risk)
TRUSTED_PROXY_IPS=172.16.0.0/12,10.0.0.0/8,192.168.0.0/16

# ── CORS (comma-separated origins, NEVER use "*") ────────────────────────────
# CORS_ORIGINS=https://myapp.example.com

# ── Features ──────────────────────────────────────────────────────────────────
ENABLE_TRAEFIK=1
AUTO_INSTALL=1

# ── ACME / Let's Encrypt (public mode only) ──────────────────────────────────
# ACME_EMAIL=admin@example.com

# ═══════════════════════════════════════════════════════════════════════════════
#  SECRETS ARCHITECTURE:
#    /opt/tpl/secrets/     ← generated by install.sh (prod, chmod 700)
#    .secrets/             ← generated by init.sh (dev, chmod 700)
#    /run/secrets/         ← mounted inside containers (read-only)
#
#  Priority: Vault tmpfs → *_FILE → HARD FAIL (no env fallback)
# ═══════════════════════════════════════════════════════════════════════════════
